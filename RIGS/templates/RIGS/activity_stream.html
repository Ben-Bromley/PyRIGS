{% extends request.is_ajax|yesno:"base_ajax.html,base.html" %}
{% load static %}

{% block title %}Rigboard Activity Stream{% endblock %}

{% block js %}
    <script src="{% static "js/tooltip.js" %}"></script>
    <script src="{% static "js/popover.js" %}"></script>
    <script src="{% static "js/moment.min.js" %}"></script>
    <script>
    	$(function () {
		  $('[data-toggle="popover"]').popover().click(function(){
        if($(this).attr('href')){
          window.location.href = $(this).attr('href');
        }
      });

          // This keeps timeago values correct, but uses an insane amount of resources
          // $(function () {
          //     setInterval(function() {
          //         $('.date').each(function (index, dateElem) {
          //           var $dateElem = $(dateElem);
          //           var formatted = moment($dateElem.attr('data-date')).fromNow();
          //           $dateElem.text(formatted);
          //          })
          //        });
          //     }, 10000);


            $('.date').each(function (index, dateElem) {
                var $dateElem = $(dateElem);
                var formatted = moment($dateElem.attr('data-date')).fromNow();
                $dateElem.text(formatted);
               });
             

		})

    </script>
{% endblock %}

{% block content %}
{# comment "table view" #}

<h2>Rigboard Activity Stream - Table View</h2>
<br>
	<table class="table table-striped">
        <thead>
        <tr>
            <td>Date</td>
            <td>Event</td>
            <td>Version ID</td>
            <td>User</td>
            <td>Changes</td>
        </tr>
        </thead>
        <tbody>
        	{% for version in object_list %}
                {% if version.item_changes or version.field_changes or version.old == None%}
                    <tr>
                        <td>{{ version.revision.date_created|date:"RIGS_DATETIME_FORMAT" }}</td>
                        <td><a href="{% url 'event_detail' version.new.pk %}">N{{ version.new.pk|stringformat:"05d" }}</a></td>
                   		<td>{{ version.version.pk }}|{{ version.revision.pk }}</td>
                        <td>{{ version.revision.user.name }}</td>
                        <td>
                          {% if version.old == None %}
                            Event Created
                          {% else %}
                            {% include 'RIGS/event_version_changes.html' %}
                          {% endif %}                        </td>
                    </tr>
                {% endif %}
			{% endfor %}

        </tbody>
    </table>
{# endcomment #}



    <div>
        <br>
    <h2>Rigboard Activity Stream - Stream View</h2>
    <br>
{% for version in object_list %}
    {% if version.item_changes or version.field_changes or version.old == None %}
        <div class="well">
            {% include 'RIGS/profile_button.html' with profile=version.revision.user %}

            {% if version.old == None %}
              created
            {% else %}
              changed {% include 'RIGS/event_version_changes.html' %} in
            {% endif %}
            {% include 'RIGS/event_button.html' with event=version.current %}

        </div>
    {% endif %}
{% endfor %}    


    </div>

	{{ thediff }}
{% endblock %}